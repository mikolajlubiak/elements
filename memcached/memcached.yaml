container:
  build: |
    FROM memcached:1.6.9-alpine
    USER root

    RUN apk update && apk add busybox-extras go supervisor

    COPY exporter /exporter
    WORKDIR /exporter
    RUN go build

    COPY ./supervisord.conf /etc/supervisord.conf

  run-cmd: ["/usr/bin/supervisord", "-c", "/etc/supervisord.conf"]
  run-writable-file-system: true

  expose:
    11211: # memcache
      tcp-internal: true
    9150: # exporter
      probe:
        disable: true
      http-internal:
        metrics-path: /metrics

  cpu: 200
  ram: 2500

  storage:
    /tmp: {temp: {max-size: 10}}
